# DOT 플랫폼 역할 시스템 요약

## 🎭 4가지 역할

| 역할 | 부여 조건 | 필수 문서 | 삭제 가능 |
|------|----------|-----------|-----------|
| **SEEKER** | 회원가입 시 자동 | - | ❌ (영구) |
| **OWNER** | 사업자등록증 제출 + 검증 | 사업자등록증 | ✅ |
| **WORKER** | 근로계약서 체결 | 근로계약서 | ✅ |
| **MANAGER** | Worker + 권한위임장 | 권한위임장 | ✅ |

---

## 🔄 역할 획득 흐름

```
                         사업자등록증
            [Seeker] ─────────────→ [Owner]
                │
                │ 근로계약서
                ↓
            [Worker] ─권한위임장→ [Manager]
```

**핵심 규칙:**
- ✅ Seeker는 모든 유저의 기본 (삭제 불가)
- ✅ Owner, Worker는 독립적 (순서 무관)
- ⚠️ **Manager는 Worker 필수** (Worker 없으면 Manager 될 수 없음)

---

## 📊 다중 인스턴스

**한 유저가 동시 보유 가능:**
- SEEKER: 1개 (고정)
- OWNER: N개 (사업장별)
- WORKER: N개 (사업장별)
- MANAGER: N개 (사업장별 Worker에서 승격)

**예시: 김철수**
```
김철수
├─ SEEKER (기본)
├─ OWNER - 카페A
├─ OWNER - 편의점B
├─ WORKER - 레스토랑C → MANAGER - 레스토랑C (권한위임)
└─ WORKER - 카페D
```

---

## 🔐 역할별 권한

### SEEKER (기본)
- 공고 검색
- 사업장 지원
- 프로필 관리

### OWNER (사업주)
- 채용 공고 등록
- 근로계약서 작성
- 직원 관리 (전체)
- 근태/급여 관리

### WORKER (근로자)
- 출퇴근 기록
- 근무 일정 확인
- 급여 명세서 조회

### MANAGER (관리자)
- **Worker 권한 모두 포함**
- 직원 관리 (일부)
- 근태 승인
- 일정 조율
- 보고서 작성

---

## 💾 데이터 구조

```typescript
// UserRole 테이블
{
  id: string
  userId: string
  role: 'SEEKER' | 'OWNER' | 'WORKER' | 'MANAGER'
  workplaceId: string
  documentId: string  // 사업자등록증 or 근로계약서 or 권한위임장
  grantedAt: Date
  revokedAt?: Date
}
```

---

## ⚠️ Manager 역할 특별 규칙

### 1. Worker 선행 조건
```typescript
// ❌ 불가능
User.addRole('MANAGER')  // Worker 없이 바로 Manager

// ✅ 가능
User.addRole('WORKER')   // 1. 먼저 Worker
User.addRole('MANAGER')  // 2. 그 다음 Manager
```

### 2. Worker 해제 시 Manager도 자동 해제
```typescript
// Worker 역할 해제 → Manager도 함께 해제
User.removeRole('WORKER', workplaceId)
→ User.removeRole('MANAGER', workplaceId) // 자동
```

### 3. 사업장별 독립적
```typescript
// 가능한 조합
- 레스토랑A: Worker + Manager
- 카페B: Worker (Manager 아님)
- 편의점C: Worker + Manager
```

---

## 📝 실제 시나리오

### 시나리오 1: 일반 알바생 → 매니저 승진
```
Day 1: 카페 지원 → Worker 역할 부여
Day 30: 성과 우수 → Owner가 권한위임장 발급
Day 30: Manager 역할 추가 (Worker는 유지)

역할: [Seeker, Worker(카페), Manager(카페)]
```

### 시나리오 2: 다중 사업장 근무
```
김영희:
- 레스토랑A: Worker + Manager (부매니저)
- 카페B: Worker (일반 알바)
- 편의점C: Owner (본인 사업)

역할: [Seeker, Owner(편의점C), Worker(A), Manager(A), Worker(B)]
```

### 시나리오 3: Manager 해제
```
레스토랑에서 퇴사:
1. Worker 역할 해제
2. Manager 역할 자동 해제 (Worker 없으면 Manager 불가)
3. Seeker 역할은 유지 → 다시 구직 활동 가능
```

---

## 🔍 권한 체크 로직

```typescript
// Manager 권한 부여 가능 여부
function canBecomeManager(user: User, workplaceId: string): boolean {
  // Worker 역할이 필수
  return user.hasRole('WORKER', workplaceId);
}

// Manager 권한 체크
function hasManagerPermission(user: User, workplaceId: string): boolean {
  return user.hasRole('MANAGER', workplaceId);
}

// Worker 해제 시 Manager도 함께 해제
async function removeWorkerRole(user: User, workplaceId: string) {
  await user.removeRole('WORKER', workplaceId);

  // Manager 역할이 있다면 함께 해제
  if (user.hasRole('MANAGER', workplaceId)) {
    await user.removeRole('MANAGER', workplaceId);
  }
}
```

---

## 📌 요약

1. **기본 역할**: Seeker (모든 유저, 영구)
2. **독립 역할**: Owner, Worker (순서 무관)
3. **종속 역할**: Manager (Worker 필수)
4. **다중 보유**: 모든 역할 사업장별 여러 개 가능
5. **문서 기반**: 사업자등록증, 근로계약서, 권한위임장